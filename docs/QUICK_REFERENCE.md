# Quick Reference Guide

## Common Usage Patterns

### 1. Collect Last 7 Days of Data

```bash
./collector.sh \
  ocid1.tenancy.oc1..aaaaaaaaoi6b5sxlv4z773boczybqz3h2vspvvru42jysvizl77lky22ijaq \
  us-ashburn-1 \
  $(date -d '7 days ago' +%Y-%m-%d) \
  $(date +%Y-%m-%d)
```

### 2. Collect Current Month Data

```bash
./collector.sh \
  ocid1.tenancy.oc1..aaaaaaaaoi6b5sxlv4z773boczybqz3h2vspvvru42jysvizl77lky22ijaq \
  us-ashburn-1 \
  $(date +%Y-%m-01) \
  $(date +%Y-%m-%d)
```

### 3. Collect Previous Month Data

```bash
./collector.sh \
  ocid1.tenancy.oc1..aaaaaaaaoi6b5sxlv4z773boczybqz3h2vspvvru42jysvizl77lky22ijaq \
  us-ashburn-1 \
  $(date -d 'last month' +%Y-%m-01) \
  $(date -d 'last month' +%Y-%m-%d)
```

## Output Analysis

### View Top 10 Most Expensive Resources

```bash
head -1 output_merged.csv && tail -n +2 output_merged.csv | sort -t, -k7 -rn | head -10
```

### Count Resources by Service

```bash
tail -n +2 output_merged.csv | awk -F, '{print $19}' | sort | uniq -c | sort -rn
```

### Sum Total Cost

```bash
tail -n +2 output_merged.csv | awk -F, '{sum+=$7} END {print "Total Cost: $" sum}'
```

### Filter Compute Instances Only

```bash
grep "Compute" output_merged.csv > compute_only.csv
```

### List All Unique Shapes

```bash
tail -n +2 output_merged.csv | awk -F, '{print $20}' | sort -u
```

## Troubleshooting

### Check Virtual Environment

```bash
ls -la venv/
```

### Recreate Virtual Environment

```bash
rm -rf venv
./collector.sh <parameters>
```

### Verify OCI CLI Works

```bash
oci iam region list
```

### Check Python Version

```bash
python3 --version
```

## Performance Tips

### For Large Date Ranges

Instead of collecting 6 months at once:

```bash
# Split into monthly chunks
./collector.sh <ocid> <region> 2025-01-01 2025-01-31
./collector.sh <ocid> <region> 2025-02-01 2025-02-28
./collector.sh <ocid> <region> 2025-03-01 2025-03-31
# ... then merge the CSV files manually
```

### Skip Instance Enrichment

If you don't need shape/resourceName and want faster execution, modify the Python script to skip the enrichment step.

## Data Fields Reference

### Cost Fields
- `computedAmount` - Total cost in currency
- `computedQuantity` - Total usage quantity
- `attributedCost` - Cost attributed to this resource
- `attributedUsage` - Usage attributed to this resource
- `currency` - Currency code (USD, etc.)

### Resource Fields
- `resourceId` - OCI Resource OCID
- `resourceName` - Display name (enriched for compute)
- `shape` - Instance shape (enriched for compute)
- `service` - OCI Service name
- `skuName` - SKU description
- `skuPartNumber` - Oracle part number

### Organizational Fields
- `compartmentId` - Compartment OCID
- `compartmentName` - Compartment name
- `compartmentPath` - Full compartment hierarchy
- `tenantId` - Tenant OCID
- `tenantName` - Tenant name

### Time Fields
- `timeUsageStarted` - Usage period start (ISO 8601)
- `timeUsageEnded` - Usage period end (ISO 8601)

## File Descriptions

### Generated by Script

1. **output_merged.csv**
   - Complete enriched dataset
   - Includes instance metadata for compute resources
   - Best for analysis and reporting

2. **output.csv**
   - Basic merged data without enrichment
   - Faster generation, no instance metadata
   - Good for quick cost summaries

3. **output.json**
   - Raw API responses from both calls
   - Useful for debugging API issues
   - Can be reprocessed without API calls

4. **instance_metadata.json**
   - Cached compute instance metadata
   - Reusable across multiple runs
   - Reduces API calls for repeated queries

## Advanced Usage

### Using Cached Metadata

The script caches instance metadata in `instance_metadata.json`. To reuse this cache for a new date range with the same instances, keep this file in the directory.

### Custom Python Processing

The Python script can be imported as a module:

```python
from src.collector import OCICostCollector

collector = OCICostCollector(
    tenancy_ocid='ocid1.tenancy...',
    home_region='us-ashburn-1',
    from_date='2025-11-01',
    to_date='2025-11-04'
)

success = collector.collect()
```

## API Reference

### OCI Usage API Endpoints

- **COST Query**: Returns financial data (costs, prices)
- **USAGE Query**: Returns consumption data (quantities, platforms)

### Valid groupBy Keys

- `service` - Service name
- `resourceId` - Resource OCID
- `skuName` - SKU description
- `skuPartNumber` - Part number
- `compartmentPath` - Compartment hierarchy
- `compartmentName` - Compartment name
- `compartmentId` - Compartment OCID
- `platform` - Platform type
- `region` - Region name
- `tenantId` - Tenant OCID
- `tenantName` - Tenant name

### Limitations

- Max 4 groupBy parameters per query
- `shape` and `resourceName` not available via groupBy
- Requires separate Compute API calls for instance metadata
